BIG SPRINT 8 PROMPT FOR CODEX / COPILOT
(Focus on teacher view MVP, class analytics, and view mode wiring)

I am on macOS. Repo is at:

~/Desktop/project-setup-bitbybit

I want you to do an eighth focused sprint to:
	‚Ä¢	Build a first teacher view MVP using the existing data
	‚Ä¢	Add backend endpoints for class level analytics that can later power real ITS
	‚Ä¢	Wire the existing Settings view mode toggle into the layout so it actually switches between student and teacher views in the UI
	‚Ä¢	Keep the student flow exactly as it is today

Please read this entire prompt before editing any files.

Use the current UI and previous Figma inspired look as a guide for tone.

‚∏ª

CURRENT SETUP (do not break)

Backend
	‚Ä¢	Flask backend under src/backend
	‚Ä¢	Entry: src/backend/main.py with create_app()
	‚Ä¢	API base: http://127.0.0.1:5000/api
	‚Ä¢	Data files under src/backend/data:
	‚Ä¢	students.json
	‚Ä¢	attempts.json
	‚Ä¢	units.json
	‚Ä¢	quizzes.json

Current student endpoints that must keep working:
	‚Ä¢	GET /api/student/student-1/state
	‚Ä¢	POST /api/student/student-1/state
	‚Ä¢	GET /api/attempts/student-1
	‚Ä¢	GET /api/units
	‚Ä¢	GET /api/student/student-1/next-activity

Frontend
	‚Ä¢	React app under src/frontend
	‚Ä¢	Key student pages:
	‚Ä¢	Home dashboard: features/home/pages/HomeDashboard.tsx
	‚Ä¢	Units flow: features/units/pages/Units.tsx, UnitDetail.tsx, Diagnostic.tsx, MiniQuiz.tsx, UnitTest.tsx, Practice.tsx
	‚Ä¢	History: features/history/pages/History.tsx
	‚Ä¢	Profile: features/profile/pages/Profile.tsx
	‚Ä¢	Settings (student vs teacher toggle stub): features/settings/pages/Settings.tsx
	‚Ä¢	Layout and sidebar: src/frontend/src/layout/AppShell.tsx
	‚Ä¢	Routes: src/frontend/src/App.jsx
	‚Ä¢	Shared helpers:
	‚Ä¢	src/frontend/src/lib/studentClient.js
	‚Ä¢	src/frontend/src/lib/attempts.ts
	‚Ä¢	src/frontend/src/lib/historyClient.js (if present)

Constraints
	‚Ä¢	Do not change package.json and do not add dependencies
	‚Ä¢	Do not remove or rename existing API routes
	‚Ä¢	Any new backend fields must be optional and backward compatible
	‚Ä¢	Use React function components and hooks only
	‚Ä¢	Keep the existing student experience working exactly as now

‚∏ª

SECTION A ‚Äì Backend teacher analytics endpoints

Goal: Give the teacher view aggregated information about multiple students, using the existing attempts and units data.

Files:
	‚Ä¢	src/backend/models.py
	‚Ä¢	src/backend/repository.py
	‚Ä¢	src/backend/main.py
	‚Ä¢	src/backend/data/students.json (read only)

Assume students.json can contain multiple student entries like student-1, student-2, etc, even if the data is small for now.
	1.	Define simple teacher facing models

In models.py, add typed dicts or small models for:
	‚Ä¢	TeacherStudentSummary with:
	‚Ä¢	student_id: str
	‚Ä¢	name: str
	‚Ä¢	overall_mastery: float (0 to 100, same rule as student mastery)
	‚Ä¢	questions_answered: int
	‚Ä¢	attempt_count: int
	‚Ä¢	last_activity_at: Optional[str] ISO timestamp or null
	‚Ä¢	TeacherUnitSummary with:
	‚Ä¢	unit_id: str
	‚Ä¢	unit_name: str
	‚Ä¢	average_mastery: float
	‚Ä¢	attempt_count: int
	‚Ä¢	student_count: int (number of students with at least one attempt in that unit)

	2.	Repository helpers for teacher data

In repository.py, add helpers like:
	‚Ä¢	get_all_students()
	‚Ä¢	Return a list of student records from students.json.
	‚Ä¢	get_attempts_for_all_students()
	‚Ä¢	Return all attempts (not just one student).
	‚Ä¢	compute_student_mastery(student_id: str) -> float
	‚Ä¢	Reuse the same mastery rules as the student view: only mini quizzes and unit tests affect mastery.
	‚Ä¢	Use existing attempt logic wherever possible.
	‚Ä¢	compute_teacher_student_summaries() -> list[TeacherStudentSummary]
	‚Ä¢	For each student in students.json, compute:
	‚Ä¢	Overall mastery
	‚Ä¢	Total questions answered (sum of len(results) for all attempts for that student)
	‚Ä¢	Attempt count
	‚Ä¢	Last activity timestamp from the latest attempt
	‚Ä¢	compute_teacher_unit_summaries() -> list[TeacherUnitSummary]
	‚Ä¢	For each unit:
	‚Ä¢	Compute average mastery across all students who have mastery data for that unit
	‚Ä¢	Count attempts in that unit
	‚Ä¢	Count students who have any attempt in that unit

Keep the logic simple and deterministic. It is fine if in the current dataset it mostly reflects student-1.
	3.	New teacher endpoints

In main.py, add these routes:
	‚Ä¢	GET /api/teacher/overview
	‚Ä¢	Returns:
	‚Ä¢	students: TeacherStudentSummary[]
	‚Ä¢	units: TeacherUnitSummary[]
	‚Ä¢	GET /api/teacher/students/<student_id>
	‚Ä¢	Returns a detailed snapshot that the teacher view can use, for example:
	‚Ä¢	student basic info from students.json
	‚Ä¢	attempts for that student (reuse structure from existing endpoints)
	‚Ä¢	unit_mastery per unit if easy to include

Document everything in simple docstrings. Do not change existing student endpoints.

‚∏ª

SECTION B ‚Äì Wire Settings view mode into layout

Goal: The Settings toggle for Student vs Teacher view should actually influence the layout and nav.

Files:
	‚Ä¢	src/frontend/src/features/settings/pages/Settings.tsx
	‚Ä¢	src/frontend/src/layout/AppShell.tsx
	‚Ä¢	src/frontend/src/App.jsx
	‚Ä¢	Optionally a small helper in src/frontend/src/lib/studentClient.js or a new viewModeClient.js

	1.	Persist view mode in localStorage

In Settings.tsx:
	‚Ä¢	Add a small hook that:
	‚Ä¢	Reads initial view mode from localStorage.getItem("bitbybit_view_mode"), defaulting to "student".
	‚Ä¢	When the user toggles between Student view and Teacher view, update both React state and localStorage.
	‚Ä¢	Keep the UI simple:
	‚Ä¢	Radio buttons or a segmented control for:
	‚Ä¢	Student view
	‚Ä¢	Teacher view (coming soon)
	‚Ä¢	A short description under Teacher view like:
	‚Ä¢	‚ÄúTeacher view shows class level progress and focus areas.‚Äù

	2.	Read view mode in AppShell

In AppShell.tsx:
	‚Ä¢	Inside the layout component, read the same value from localStorage:
const [viewMode, setViewMode] = useState<"student" | "teacher">("student");

useEffect(() => {
  const stored = window.localStorage.getItem("bitbybit_view_mode");
  if (stored === "teacher" || stored === "student") {
    setViewMode(stored);
  }
}, []);
	‚Ä¢	Use viewMode to control which nav items appear.

	3.	Nav behavior based on view mode

	‚Ä¢	In Student view:
	‚Ä¢	Show the current nav items:
	‚Ä¢	Home
	‚Ä¢	Units
	‚Ä¢	History
	‚Ä¢	Profile
	‚Ä¢	Settings at the bottom
	‚Ä¢	In Teacher view:
	‚Ä¢	Still show Settings at the bottom.
	‚Ä¢	Replace or supplement the main nav with:
	‚Ä¢	Home (can show student style for now, or a simplified teacher dashboard)
	‚Ä¢	Teacher dashboard (new page, see Section C)
	‚Ä¢	A link back to student Home if you prefer, but keep labels clear.

Try to keep code paths simple: you can always show Home and Settings, and conditionally show either Student nav group or Teacher nav group.

‚∏ª

SECTION C ‚Äì Teacher dashboard page

Goal: A single teacher dashboard page that summarises class performance using the new backend endpoints.

Files:
	‚Ä¢	New page: src/frontend/src/features/teacher/pages/TeacherDashboard.tsx
	‚Ä¢	Routing: src/frontend/src/App.jsx
	‚Ä¢	Nav: src/frontend/src/layout/AppShell.tsx
	‚Ä¢	Styles: src/frontend/src/App.css

	1.	Teacher client helper

In src/frontend/src/lib/studentClient.js or a new helper file like teacherClient.js:
	‚Ä¢	Add a function:
export async function fetchTeacherOverview() {
  const res = await apiClient.get("/teacher/overview");
  return res.data;
}
	‚Ä¢	Optionally add:
export async function fetchTeacherStudentDetail(studentId) {
  const res = await apiClient.get(`/teacher/students/${studentId}`);
  return res.data;
}
Use the existing apiClient and base URL.
	2.	TeacherDashboard layout

Create TeacherDashboard.tsx with something like:
	‚Ä¢	A top header:
	‚Ä¢	Title: ‚ÄúClass overview‚Äù
	‚Ä¢	Subtitle: ‚ÄúSee how your students are progressing.‚Äù
	‚Ä¢	On mount:
	‚Ä¢	Call fetchTeacherOverview().
	‚Ä¢	Show loading and error states similar to other pages.
	‚Ä¢	Two main cards:
	1.	‚ÄúStudents‚Äù card (table or grid):
	‚Ä¢	Columns:
	‚Ä¢	Name
	‚Ä¢	Overall mastery percent
	‚Ä¢	Questions answered
	‚Ä¢	Attempts
	‚Ä¢	Last activity date
	‚Ä¢	Optionally clicking a row can open a simple drawer or inline detail that calls fetchTeacherStudentDetail(studentId) and shows that student‚Äôs history and unit mastery summary.
	2.	‚ÄúUnits‚Äù card:
	‚Ä¢	List all units with:
	‚Ä¢	Unit name
	‚Ä¢	Average mastery
	‚Ä¢	Attempt count
	‚Ä¢	Number of students with activity in that unit

	3.	Styling

	‚Ä¢	In App.css, add teacher dashboard specific classes that reuse the same card styles as Home and Profile.
	‚Ä¢	Keep the teacher cards slightly more compact and table like, but still consistent with the product style.
	‚Ä¢	It should look ready to show in a class or demo.

	4.	Routes and nav wiring

	‚Ä¢	In App.jsx, add a route:
<Route path="/teacher" element={<TeacherDashboard />} />
	‚Ä¢	In AppShell.tsx, when viewMode === "teacher", show a ‚ÄúTeacher dashboard‚Äù nav item that links to /teacher.

‚∏ª

SECTION D ‚Äì Teacher student detail pane (lightweight)

Goal: When the teacher clicks a student in the class list, let them see that student‚Äôs focus areas and last few attempts, without building a whole new app.

Files:
	‚Ä¢	TeacherDashboard.tsx
	‚Ä¢	Optionally new component: src/frontend/src/features/teacher/components/StudentDetailDrawer.tsx
	‚Ä¢	src/frontend/src/App.css

	1.	Detail panel behavior

	‚Ä¢	When a row in the Students table is clicked:
	‚Ä¢	Set selectedStudentId in state.
	‚Ä¢	Call fetchTeacherStudentDetail(selectedStudentId) if not already loaded.
	‚Ä¢	Show a side panel or modal anchored to the dashboard card with:
	‚Ä¢	Student name
	‚Ä¢	Overall mastery
	‚Ä¢	A short list of units with mastery bars for that student
	‚Ä¢	A list of their last 3 attempts:
	‚Ä¢	Date
	‚Ä¢	Unit or section
	‚Ä¢	Quiz type
	‚Ä¢	Score
	‚Ä¢	Add a close button on the panel.

	2.	Safety and UX

	‚Ä¢	Handle loading and error states in the detail panel.
	‚Ä¢	If the backend has only one student, the UI should still behave correctly.

‚∏ª

SECTION E ‚Äì Visual polish and consistency

Goal: Keep the new teacher view in harmony with the student UI.

Files:
	‚Ä¢	src/frontend/src/App.css
	‚Ä¢	TeacherDashboard.tsx
	‚Ä¢	Settings.tsx

Changes:
	1.	Reuse card styles

	‚Ä¢	Use the same card classes as Home and Profile for the teacher cards.
	‚Ä¢	Ensure consistent padding, border radius, shadows.

	2.	Labels and hints

	‚Ä¢	In Settings, under Teacher view, include a muted line like:
	‚Ä¢	‚ÄúUse this mode to preview what a teacher dashboard could look like.‚Äù
	‚Ä¢	In the Teacher dashboard, use small, clear labels for columns and avoid clutter.

	3.	Keep it school friendly

	‚Ä¢	No wild colors or memes.
	‚Ä¢	Emojis are allowed in a subtle way only, for example a small üéì in a ‚ÄúClass overview‚Äù title if it fits the style.

‚∏ª

SECTION F ‚Äì Sanity checks

After your changes, verify:
	1.	Student view still works:

	‚Ä¢	Home, Units, History, Profile, and Settings all behave as before when view mode is Student.
	‚Ä¢	History still renders correctly with the defensive chart.

	2.	View mode toggle:

	‚Ä¢	Switching to Teacher view in Settings updates localStorage and persists on reload.
	‚Ä¢	AppShell reads the mode and shows appropriate nav items.

	3.	Teacher view:

	‚Ä¢	/teacher loads without console errors.
	‚Ä¢	GET /api/teacher/overview and GET /api/teacher/students/student-1 are called and return valid data.
	‚Ä¢	Students card and units card render coherent numbers.

	4.	Mixed mode:

	‚Ä¢	Toggling from Teacher view back to Student view returns you to the student nav without refresh.
	‚Ä¢	Settings remains accessible from both modes.

	5.	Build and backend:

From src/frontend:
	‚Ä¢	npm run build works with no errors.

From src:
	‚Ä¢	python -m backend.main still starts normally, and existing student routes respond as before.

If anything would break these, adjust the implementation while keeping the new teacher view features intact.

‚∏ª
