BIG SPRINT 9 PROMPT FOR CODEX / COPILOT
(Focus on multi student onboarding, stronger teacher tools, and production ready UX)

I am on macOS. Repo is at:

~/Desktop/project-setup-bitbybit

I want you to do a ninth focused sprint to:
	•	Make it feel like a real app where multiple students can use it, not just student-1
	•	Give teachers better tools to manage and inspect students from the teacher view
	•	Smooth out onboarding and empty states so a brand new user is guided into their first quiz
	•	Tighten the UX and keep everything stable for a future Vercel deployment

Please read this whole prompt before editing any files.

Use the current UI and the previous Figma inspired style as the visual guide.

⸻

CURRENT SETUP (do not break)

Backend
	•	Flask backend under src/backend
	•	Entry: src/backend/main.py with create_app()
	•	API base: http://127.0.0.1:5000/api
Keep this default. If you introduce any configurability, it must fall back to this value.
	•	Data files under src/backend/data:
	•	students.json
	•	attempts.json
	•	units.json
	•	questions.json
	•	quizzes.json

Existing endpoints that must keep working exactly as now:
	•	GET /api/student/student-1/state
	•	POST /api/student/student-1/state
	•	GET /api/attempts/student-1
	•	GET /api/units
	•	GET /api/student/student-1/next-activity
	•	GET /api/teacher/overview
	•	GET /api/teacher/students/<student_id>

Frontend
	•	React app under src/frontend
	•	Key student pages:
	•	Home: features/home/pages/HomeDashboard.tsx
	•	Units: features/units/pages/Units.tsx, UnitDetail.tsx, Diagnostic.tsx, MiniQuiz.tsx, UnitTest.tsx, Practice.tsx
	•	History: features/history/pages/History.tsx
	•	Profile: features/profile/pages/Profile.tsx
	•	Settings: features/settings/pages/Settings.tsx
	•	Teacher:
	•	Dashboard: features/teacher/pages/TeacherDashboard.tsx
	•	Student drawer: features/teacher/components/StudentDetailDrawer.tsx
	•	Layout and nav:
	•	layout/AppShell.tsx
	•	Routes in src/frontend/src/App.jsx
	•	Shared helpers:
	•	lib/apiClient.js
	•	lib/studentClient.js
	•	lib/teacherClient.ts
	•	lib/historyClient.js
	•	lib/attempts.ts
	•	lib/viewMode.ts

Constraints
	•	Do not change package.json
	•	Do not add new dependencies
	•	Do not remove or rename existing API routes
	•	Any new backend fields must be optional and backward compatible
	•	Use React function components and hooks only
	•	Keep all existing student and teacher flows working as they are today

⸻

SECTION A - Multi student support and basic onboarding

Goal: allow the app to work cleanly for more than one student, and give a gentle onboarding path for a brand new student.

Files:
	•	Backend:
	•	src/backend/models.py
	•	src/backend/repository.py
	•	src/backend/main.py
	•	src/backend/data/students.json
	•	Frontend:
	•	src/frontend/src/lib/studentClient.js
	•	src/frontend/src/lib/viewMode.ts (or a new helper if needed)
	•	src/frontend/src/features/settings/pages/Settings.tsx
	•	src/frontend/src/layout/AppShell.tsx
	•	src/frontend/src/features/home/pages/HomeDashboard.tsx
	•	src/frontend/src/features/profile/pages/Profile.tsx

Backend changes:
	1.	Students listing endpoint

Add a simple endpoint that returns all students from students.json:
	•	GET /api/students

Response shape:
{
  "students": [
    { "id": "student-1", "name": "Alex Chen", "email": "alex@example.com" },
    ...
  ]
}
Use existing student model structure from students.json. Keep this read only.
	2.	Optional student creation helper (simple demo only)

If this is straightforward, add a demo style endpoint:
	•	POST /api/students

Request body:
{ "name": "New Student Name" }
Behavior:
	•	Generate a new student_id such as student-2, student-3, etc.
	•	Append a new record to students.json with default fields (basic name, placeholder email, zero stats).
	•	Initialize any required state in students.json so that GET /api/student/<id>/state can return something sensible.

If file write becomes too complex, skip the POST and just keep the GET /api/students listing. Do not break any existing student endpoints.

Frontend changes:
	3.	Current student id management

Introduce a central way to know which student is currently active in student view.
	•	In viewMode.ts or a new helper file (for example currentStudent.ts):
	•	Add functions:
	•	getCurrentStudentId() - reads from localStorage.getItem("bitbybit_current_student_id") or falls back to "student-1".
	•	setCurrentStudentId(id) - stores the id in localStorage.
	•	Update studentClient.js so that:
	•	All calls that currently hard code "student-1" instead use getCurrentStudentId() when building URLs like /student/${id}/state or /attempts/${id}.
	•	Keep the old student-1 specific routes compatible if needed, but prefer the dynamic ones.

	4.	Student selector in Settings

In Settings.tsx:
	•	When in Student view:
	•	Fetch the list of students from GET /api/students.
	•	Show a simple dropdown or list of students:
	•	Current selection is getCurrentStudentId().
	•	When selecting a different student:
	•	Call setCurrentStudentId(newId).
	•	Optionally show a small note like: “Student view will now show data for ”.
	•	If the backend only has one student, the UI should still work and just show that one.

	5.	Optional quick switch on Profile

In Profile.tsx, near the header:
	•	Show the current student name.
	•	Add a small “Switch student” link that navigates to Settings or opens a mini selector, whichever is easier.
	•	This is purely convenience. All state should still live in Settings and localStorage.

⸻

SECTION B - Teacher dashboard quality of life and “view as student”

Goal: let a teacher quickly jump into a student’s view and improve the dashboard for real class usage.

Files:
	•	src/frontend/src/features/teacher/pages/TeacherDashboard.tsx
	•	src/frontend/src/features/teacher/components/StudentDetailDrawer.tsx
	•	src/frontend/src/lib/teacherClient.ts
	•	src/frontend/src/lib/viewMode.ts or currentStudent helper
	•	src/frontend/src/layout/AppShell.tsx
	•	src/frontend/src/App.css

Changes:
	1.	“View as this student” action

In StudentDetailDrawer.tsx:
	•	Add a button such as “View as student”.
	•	On click:
	•	Call setCurrentStudentId(selectedStudentId).
	•	Call setViewMode("student") using the same localStorage key used in Settings.
	•	Use navigation to send the user to the student Home route /.
	•	This lets a teacher click a student, then instantly see the app as that student would.

	2.	Sort and filter on students list

In TeacherDashboard.tsx:
	•	On the Students list:
	•	Add a simple sort control (for example a small select) to sort by:
	•	Name
	•	Overall mastery
	•	Last activity
	•	Add a small text input for filtering by student name.
	•	All of this happens client side on the array returned by /teacher/overview.

	3.	Small summary chips on units list

On the Units card in teacher dashboard:
	•	For each unit row, add one line under the unit name such as:
	•	“Average mastery 72 percent · 14 students · 32 attempts”
	•	Keep styling light and aligned with existing cards.

⸻

SECTION C - First run and empty state onboarding

Goal: make the app feel welcoming for a brand new student with zero attempts.

Files:
	•	src/frontend/src/features/home/pages/HomeDashboard.tsx
	•	src/frontend/src/features/history/pages/History.tsx
	•	src/frontend/src/features/profile/pages/Profile.tsx
	•	src/frontend/src/App.css

Changes:
	1.	Home first run state

In HomeDashboard.tsx:
	•	Detect the case where the current student has:
	•	No attempts at all, and
	•	Possibly no diagnostic for any unit yet.
	•	In that case:
	•	Show a gentle first run panel at the top of the page, for example:
	•	Title: “Welcome, let us get you started”
	•	Text: “Start with a quick diagnostic so we can place you at the right level.”
	•	Button: “Take your first diagnostic” that navigates to the first unit’s diagnostic route.
	•	Once the student completes at least one attempt, hide this first run panel.

	2.	History empty state

You already added an empty state for History when there is no data.
	•	Make sure the text is helpful:
	•	“No quiz history yet. Complete a quiz to see your progress here.”
	•	Style this in App.css so it looks like part of the product, not just plain text.

	3.	Profile empty state touches

In Profile.tsx:
	•	When the student has zero attempts:
	•	Show a short note under stats like:
	•	“You have not completed any quizzes yet. Start with a diagnostic in Units to unlock your stats.”
	•	Keep this logic simple and driven by attempts count.

⸻

SECTION D - Mobile and small screen polish

Goal: make the app usable on smaller laptop screens and tablets. No need for full phone preview, but it should not break at narrower widths.

Files:
	•	src/frontend/src/App.css
	•	src/frontend/src/index.css
	•	Key layout components:
	•	layout/AppShell.tsx
	•	features/home/pages/HomeDashboard.tsx
	•	features/units/pages/Units.tsx
	•	features/history/pages/History.tsx
	•	features/profile/pages/Profile.tsx
	•	features/teacher/pages/TeacherDashboard.tsx

Changes:
	1.	Sidebar behavior

	•	Add a simple media query so that on very narrow screens:
	•	Sidebar width shrinks a bit.
	•	Main content still has reasonable padding.
	•	It is fine if the sidebar stays visible. Just avoid horizontal scroll bars.

	2.	Card layout

	•	On Home and Teacher dashboard:
	•	Ensure cards that appear in a grid on desktop stack vertically on small screens.
	•	Use CSS media queries to switch grid-template-columns from 3 columns to 1 or 2 based on width.

	3.	Chart and tables

	•	In History and Teacher dashboard tables:
	•	Ensure table content wraps rather than overflowing horizontally.
	•	If needed, allow a controlled horizontal scroll within the card, but keep it neat.
SECTION F - UX sharp edges and error handling

Goal: catch the small issues that could confuse a teacher or student.

Files:
	•	src/frontend/src/features/home/pages/HomeDashboard.tsx
	•	src/frontend/src/features/units/pages/Practice.tsx
	•	src/frontend/src/features/teacher/pages/TeacherDashboard.tsx
	•	src/frontend/src/features/teacher/components/StudentDetailDrawer.tsx
	•	src/frontend/src/App.css

Changes:
	1.	Home recommended card fallback

On Home:
	•	If GET /teacher/overview or GET /student/.../next-activity fails or returns no recommendation:
	•	The “Recommended next step” card should show a friendly fallback such as:
	•	“Keep practicing in any unit. We will recommend a next step once you complete a quiz.”
	•	Do not leave the card empty.

	2.	Practice leave confirmation

In Practice.tsx:
	•	If the student has answered at least one question in the current session and clicks “End session” or navigates away:
	•	Optionally show a light confirmation (could be window.confirm for now):
	•	“End this practice session and save your progress?”
	•	Only end the session if they confirm.
	•	This is optional, but useful to avoid accidental loss of a long practice run.

	3.	Teacher detail robustness

In StudentDetailDrawer.tsx:
	•	Ensure all arrays are guarded:
	•	If the student has no attempts, show a short message instead of an empty list.
	•	Make sure unit mastery bars do not crash when there is missing data.
	•	If the detail endpoint errors, show a small error message inside the drawer instead of leaving it blank.

⸻

SECTION G - Sanity checks

After your changes, verify:
	1.	Student view

	•	Settings lets you choose between existing students.
	•	Changing the current student id updates:
	•	Home data
	•	Units data
	•	History
	•	Profile
	•	A brand new student with no attempts sees clean empty states rather than broken charts.

	2.	Teacher view
	•	/teacher still loads without errors.
	•	Students card supports sort and filter.
	•	Clicking a student row opens the detail drawer.
	•	“View as student” sets the current student id, flips view mode to Student, and navigates to the student Home screen.
	•	Export CSV buttons download valid CSV files.

3.	View mode

	•	Settings view mode toggle still persists to localStorage.
	•	Reloading the app keeps the chosen mode and current student id.

	4.	Responsiveness

	•	Narrow the browser window and make sure Home, Units, History, Profile, and Teacher dashboard remain usable.
	•	No ugly horizontal scroll bars across the whole page.

	5.	Build and backend

From src/frontend:
	•	npm run build passes with no errors.

From src:
	•	python -m backend.main still starts, existing endpoints behave as before, and new endpoints respond as expected.

If any of these would break with your implementation, adjust the code so that everything works while keeping the new features.

⸻
